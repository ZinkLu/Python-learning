# 11. 文件操作

## 目标
- 文件的概念
- 文件的基本操作
- 文件/文件夹的常用操作
- 文本文件的编码方式

<br><br><br>

## 1、文件的概念

### 1.1 文件的概念和作用
- 就是储存在某种 **长期存储设备** 上的一段数据

### 1.2 文件的存储方式
- 在计算机中，文件是以 **二进制** 的方式保存在磁盘上的

**文本文件和二进制文件**
- 文本文件
	- 可以使用 **文本编辑器** 查看
	- 本质上还是二进制文件
	- 例如Python的源程序
- 二进制文件
	- 保存的内容不是给人直接阅读的，而是 **提供给其他软件的使用的**
	- 例如：图片文件、音频文件、视频文件等等
	- 二进制文件不能使用 **文本编辑软件** 查看

<br><br><br>


## 2、文件的基本操作

### 2.1 操作文件的套路
在计算机中要操作文件的套路非常固定，一共包含三个步骤：
1. 打开文件
2. 读、写文件
	- **读** 将文件内容读入内存
	- **写** 将内存内容写入文件
3. 关闭文件

### 2.2 操作文件的函数/方法
- 在`Python`中操作文件需要记住1个函数和3个方法

序号|函数/方法|说明
---|---|---
01|open|打开文件，并且返回文件操作对象
02|read|将文件内容读取到内存
03|write|将制定内容写入文件
04|close|关闭文件

- `open`函数负责打开文件，并且返回 **文件对象**
- `read`/`weite`/`close` 三个方法都需要通过 **文件对象** 来调用

### 2.3 read 方法 -- 读取文件
- `open`函数的第一个参数是要打开的文件名（文件名区分大小写）
	- 如果文件存在，返回 **文件操作对象**
	- 如果文件不存在，会 **抛出异常**
- `read`方法可以一次性 **读入** 并 **返回** 文件的 **所有内容**
- `close`方法负责 **关闭文件**
	- 如果忘记关闭文件，会造成系统资源消耗，而且会影响到后续对文件的访问
- **注意**： 方法执行后，会把 **文件指针** 移动到 **文件的末尾**

```python
# 1. 打开文件 ，如果想在控制台输出中文，需要设置encoding参数
file = open("README", encoding="utf-8")

# 2. 读取文件内容
text = file.read()
print(text)

# 3. 关闭文件
file.close()
```

**tip**
- 在开发中，通常会先将 **打开**、**关闭** 操作做完，再编写针对文件的 **读/写** 操作

**文件指针**
- **文件指针** 标记 **从哪个位置开始读取数据**
- 第一次打开文件时，通常文件指针指向 **文件的开始位置**
- 当执行了`read`方法后，文件指针会移动到 **读取内容的末尾**（默认情况下）
- 如果执行了一次read再执行一次将不能读取到任何内容

### 2.4 打开文件的方式
- `open`函数默认以只读方式打开文件

```python
file = open("文件名", "访问方式")
```

访问模式|说明
|:---:|---|
r|以只读方式打开文件。文件的指针会放在文件的开头。如果文件不存在，则抛出异常，这是默认模式
w|打开一个文件只用于写入。如果该文件已存放则将其覆盖。如果该文件不存在，创建新文件。
a|打开一个文件用于 **追加** 。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件
r+|打开一个文件用于读写。文件的指针会放在文件的开头。如果文件不存在，则抛出异常
w+|打开一个文件用于读写。文件不存在新建文件，如果该文件已存在则先删除原先的文件。
a+|打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件结尾，如果不存在，则新建
rb|以二进制格式打开一个文件用于只读。
wb|以二进制的格式打开一个文件只用于写入
ab|以二进制的格式打开文件用于追加
rb+|二进制方式读写，在开头追加
rw+|二进制方式读写，新建/覆盖
ab+|二进制方式读写，在结尾追加追加

**注意**
- 频繁的移动文件指针，**会影响文件的读写效率**，开发中更多的时候以 **只读、只写** 的方式来操作文件

### 2.5 按行读取文件内容
- `read`方法默认会把文件的 **所有内容** **一次性** 读取到内存
- 如果文件太大，对内存的占用会非常严重

**readline方法**
- `readline`方法可以一次读取一行内容
- 方法执行后，会把 **文件指针** 移动到下一行，准备再次读取

**读取大文件的正确姿势**

```python
file = open("README")

while True:
    text = file.readline()

    print(text)

    # 判断是否读取到内容
    # if text == "": #这个判断行不行呢？

    # 这什么意思？判断text有没有内容
    if not text:

        break

file.close()
```

**小文件的复制**

```python
# 1. 打开文件
file_read = open("README")
file_write = open("README[附件]", "w")


# 2. 读写
text = file_read.read()
file_write.write(text)


# 3. 关闭文件
file_read.close()
file_write.close()
```

**大文件的复制**
- 打开一个已有文件，逐行读取内容，逐行写到新文件中

```python
# 1. 打开文件
file_read = open("README", encoding="utf-8")
file_write = open("README[附件]", "w", encoding="utf-8")


# 2. 读写
while True:
    # 读取一行内容
    text = file_read.readline()

    # 判断是否读取到内容
    if not text:
        break

    file_write.write(text)


# 3. 关闭文件
file_read.close()
file_write.close()
```

**read/readlines/readline**的区别
- `read`一次性读取所有文本，如果读完了再读会得到空字符串，`read(n)`，一次性读取n个字节
- `readlines`读完所有文本，将每一行文本保存在列表中，如果读完了再读会得到一个空列表
- `readline`一次只读一行，由于有文件指的存在，再次`readline`可以读取下一行，如果读完了再读取会得到一个空的字符串

<br><br><br>

## 3、文件/目录的常用管理操作
- 在 **终端/文件浏览器** 、中可以执行的常规 **文件/目录** 管理操作，例如：
	- 创建、重命名、删除、改变路径、查看目录内容..
- 在`Python`中，如果希望通过程序实现上述功能，需要导入`os`模块

    ```python
    import os
    ```

### 文件操作
序号|方法名|说明|实例
---|---|---|---
01|rename|重命名文件|os.rename("源文件名", "目标文件名")
02|remove|删除文件|os.remove（"文件名"）

### 目录操作
序号|方法名|说明|实例
---|---|---|---
01|listdir|目录列表|os.listdir(目录名)
02|mkdir|创建目录|os.mkdir(目录名)
03|rmdir|删除目录|os.rmdir(目录名)
04|getcwd|获取当前目录|os.getcwd()
05|chdir|修改工作目录|os.chdir(目标目录)
06|path.isdir/path.isfile|判断是否是文件夹/文件|os.path.isdir(文件路径)

> tip: 文件或者目录都支持 相对路径 和 绝对路径

<br><br><br>


## 4、文本文件的编码格式
- 文本文件储存的内容是基于 **字符编码** 的文件，常见的编码有 `ASCII`编码，`UNICODE`编码等

> Pyhton2.0 默认使用ASCII编码
> Python3.0 默认使用UTF-8编码

### 4.1 ASCII编码和UNICODE编码

#### ASCII编码
- 计算机中只有`256`个ASCII字符
- 一个`ASCII`在内存中占用 **1个字节的空间**
	- `8`个`0/1`的排练组合一共有256中（2**8）

#### UTF-8编码格式
- 计算机中使用 **1-6个字节** 来表示一个UTF-8字符，涵盖了地球上 **几乎所有** 地区的文字
- 大多数汉子会使用 **3个字节** 表示
- `UTF-8`是`UNICODE`编码的一种编码格式

### 4.3 Python2 中如何使用中文

- 在 python2文件第一行写(第一种官方推荐)

```python
# *-* coding:utf8 *-*
```

或者

```python
# coding=utf8
```

**Unicode字符串**
- 在`python2`中，即使指定了文件使用的`UTF-8`的编码格式，但是在遍历字符串时，仍然会 **一字节为单位遍历** 字符串
- 要能够 **正确的遍历字符串** ，在定义字符串时，需要 **在字符串的引号前**，增加一个`u`来告诉解释器这是一个`Unicode`字符串




















